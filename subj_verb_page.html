<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Retro Grammar Terminal — Subject–Verb Agreement Trainer</title>
<style>
  :root{
    --bg:#000; --fg:#00ff7f; --dim:#1a7f5a; --accent:#7fff00; --bad:#ff6b6b; --good:#7CFC00;
    --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  }
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--fg); font-family:var(--mono);
    display:flex; align-items:center; justify-content:center; padding:24px;
  }
  .crt{
    width:min(980px, 95vw); min-height:70vh; border:2px solid var(--dim);
    box-shadow:0 0 12px #0f0, inset 0 0 12px #0f0; padding:20px 18px 16px; position:relative;
    background: radial-gradient(ellipse at center, rgba(0,255,127,0.08) 0%, rgba(0,0,0,0.2) 60%, rgba(0,0,0,0.6) 100%);
  }
  .scanline{
    pointer-events:none; position:absolute; inset:0;
    background: repeating-linear-gradient(0deg, rgba(0,255,127,0.08) 0 2px, transparent 2px 4px);
    mix-blend-mode:screen;
  }
  h1{font-size:18px; margin:0 0 12px; letter-spacing:.04em; color:var(--accent)}
  .row{display:flex; gap:16px; flex-wrap:wrap}
  .panel{flex:1 1 320px; border:1px solid var(--dim); padding:12px; min-height:160px}
  .muted{color:var(--dim)}
  .kbd{display:inline-block; border:1px solid var(--dim); padding:0 6px; margin:0 2px}
  button{
    background:transparent; color:var(--fg); border:1px solid var(--dim);
    padding:8px 12px; cursor:pointer; font-family:var(--mono); letter-spacing:.02em;
  }
  button:hover{border-color:var(--accent); color:var(--accent)}
  .choices{list-style:none; padding:0; margin:8px 0}
  .choices li{margin:6px 0}
  .choices button{width:100%; text-align:left}
  .good{color:var(--good)}
  .bad{color:var(--bad)}
  .status{margin-top:10px}
  .footer{margin-top:14px; font-size:12px}
  .controls{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  textarea{
    width:100%; min-height:130px; background:#001a12; color:var(--fg); border:1px solid var(--dim); padding:8px; font-family:var(--mono);
  }
  details summary{cursor:pointer; color:var(--accent)}
  a{color:var(--accent); text-decoration:underline}
  .cursor::after{content:"▍"; margin-left:4px; color:var(--accent); animation:blink 1.1s steps(1) infinite}
  @keyframes blink{50%{opacity:0}}
  .tag{border:1px solid var(--dim); padding:2px 6px; margin-left:6px}
</style>
</head>
<body>
  <main class="crt" role="main" aria-label="Retro Grammar Terminal">
    <div class="scanline" aria-hidden="true"></div>

    <h1>retro-grammar$ <span class="cursor">Subject–Verb Agreement Trainer</span></h1>

    <div class="row" style="margin-bottom:10px">
      <div class="panel" id="quizPanel" aria-live="polite">
        <div class="muted">Prompt:</div>
        <div id="prompt" style="white-space:pre-wrap"></div>

        <ol class="choices" id="choices"></ol>

        <div class="controls">
          <button id="revealBtn" title="Reveal the correct answer">Reveal</button>
          <button id="nextBtn" title="Load the next item">Next</button>
          <span class="tag" id="modeTag">mode: identify-verb</span>
          <span class="tag" id="counterTag">1/1</span>
        </div>

        <div class="status" id="status"></div>
        <div id="explain" class="footer muted"></div>
      </div>

      <div class="panel">
        <div class="muted" style="margin-bottom:6px">Modular Data (JSON):</div>
        <details>
          <summary>How to load new questions</summary>
          <p class="muted">
            Paste JSON below and press <span class="kbd">Load JSON</span>. The expected schema is an array of objects:
          </p>
          <pre class="muted" style="white-space:pre-wrap; font-size:12px">
[
  {
    "type": "identify-verb",        // or "identify-subject" or "agreement-yesno"
    "sentence": "I like to build things with ChatGPT.",
    "choices": ["like","build","things","with","ChatGPT"],
    "answerIndex": 0,
    "explanation": "“like” is the finite main verb; see Baskervill &amp; Sewell §440.",
    "sources": ["BaskervillSewell"]
  }
]
          </pre>
        </details>
        <textarea id="jsonInput" placeholder='[ { "type": "identify-verb", ... } ]'></textarea>
        <div class="controls">
          <button id="loadBtn">Load JSON</button>
          <button id="resetBtn" title="Restore built-in demo set">Reset to Demo</button>
        </div>
        <p class="muted" style="margin-top:10px">
          Keyboard: <span class="kbd">1–9</span> to answer · <span class="kbd">R</span> reveal · <span class="kbd">N</span> next
        </p>
      </div>
    </div>

    <details>
      <summary>Reference rules (public-domain summaries)</summary>
      <ul>
        <li>Verbs agree with their subjects in number and person; identify the true subject and match the finite verb form. (Baskervill &amp; Sewell, <em>An English Grammar</em>, Part II, esp. §§ 440–447). Sources below.</li>
        <li>A sentence requires a subject and a verb; without a substantive there is no subject, and without a verb there is no predicate. (Kittredge &amp; Farley, <em>An Advanced English Grammar</em>, Ch. I).</li>
        <li>Avoid placing material between the subject and the principal verb that obscures their relation. (Strunk, <em>The Elements of Style</em>, Rule “Keep related words together”).</li>
        <li>Everyday illustrations warn against mismatched number (for example, “pigs is pigs”). (Marley, <em>Word Study and English Grammar</em>).</li>
      </ul>
    </details>

    <details style="margin-top:10px">
      <summary>APA references (public domain)</summary>
      <ol id="refs" style="font-size:12px; line-height:1.4">
        <li id="ref-BaskervillSewell">
          Baskervill, W. M., &amp; Sewell, J. W. (1895). <em>An English grammar</em>. Project Gutenberg. https://www.gutenberg.org/ebooks/14006
        </li>
        <li id="ref-KittredgeFarley">
          Kittredge, G. L., &amp; Farley, F. E. (1913). <em>An advanced English grammar with exercises</em>. Project Gutenberg. https://www.gutenberg.org/files/45814/45814-h/45814-h.htm
        </li>
        <li id="ref-Strunk">
          Strunk, W. (1918). <em>The elements of style</em>. Project Gutenberg. https://www.gutenberg.org/files/37134/37134-h/37134-h.htm
        </li>
        <li id="ref-Marley">
          Marley, A. E. (1918). <em>Word study and English grammar</em>. Project Gutenberg. https://www.gutenberg.org/files/30036/30036-h/30036-h.htm
        </li>
        <li id="ref-ReedKellogg">
          Reed, A., &amp; Kellogg, B. (1878). <em>Graded lessons in English</em>. Project Gutenberg. https://www.gutenberg.org/ebooks/7010
        </li>
      </ol>
      <div class="muted" style="font-size:12px">
        Notes: All references are public-domain editions hosted by Project Gutenberg. For historical context on Reed–Kellogg diagrams, see Public Domain Review (not itself PD but descriptive): https://publicdomainreview.org/collection/diagramming-sentences-in-the-19th-century/
      </div>
    </details>
  </main>

<script>
/* ===========================
   Modular data (demo set)
   =========================== */
const PUBLIC_DOMAIN_SOURCES = {
  BaskervillSewell: "Baskervill & Sewell (1895) — verb agrees with subject; §§ 440–447.",
  KittredgeFarley: "Kittredge & Farley (1913) — a sentence requires a subject and a verb.",
  Strunk: "Strunk (1918) — keep subject and principal verb together.",
  Marley: "Marley (1918) — cautionary examples of mismatched number.",
  ReedKellogg: "Reed & Kellogg (1878) — foundational pedagogy for parts of speech."
};

/* Demo items. You may replace these by loading JSON. */
let ITEMS = [
  {
    type: "identify-verb",
    sentence: "I like to build things with ChatGPT.",
    choices: ["like","build","things","with","ChatGPT"],
    answerIndex: 0,
    explanation: "“like” is the finite main verb in simple present, 1st person singular. The infinitive “to build” is not the finite verb.",
    sources: ["BaskervillSewell","KittredgeFarley"]
  },
  {
    type: "identify-subject",
    sentence: "The swarm of bees was loud.",
    choices: ["swarm","bees","was","loud"],
    answerIndex: 0,
    explanation: "The head noun is “swarm”. The prepositional phrase “of bees” is not the subject. The verb “was” agrees with the singular head.",
    sources: ["BaskervillSewell","Strunk"]
  },
  {
    type: "agreement-yesno",
    sentence: "The list of items are long.",
    choices: ["Agree","Does not agree"],
    answerIndex: 1,
    explanation: "The head noun is “list” (singular). The predicate should use a singular verb: “The list of items is long.”",
    sources: ["BaskervillSewell","Marley"]
  },
  {
    type: "identify-verb",
    sentence: "Rivers and creeks flow after the storm.",
    choices: ["Rivers","and","creeks","flow","after","storm"],
    answerIndex: 3,
    explanation: "“flow” is the finite main verb. The compound subject “Rivers and creeks” takes a plural verb.",
    sources: ["BaskervillSewell"]
  },
  {
    type: "agreement-yesno",
    sentence: "Neither the coach nor the players were early.",
    choices: ["Agree","Does not agree"],
    answerIndex: 0,
    explanation: "With “neither…nor,” the verb typically agrees with the nearer subject; “players” is plural, so “were” is acceptable in traditional guidance.",
    sources: ["BaskervillSewell"]
  }
];

/* ===========================
   App state
   =========================== */
let idx = 0;
const promptEl  = document.getElementById("prompt");
const choicesEl = document.getElementById("choices");
const statusEl  = document.getElementById("status");
const explainEl = document.getElementById("explain");
const modeTag   = document.getElementById("modeTag");
const counterTag= document.getElementById("counterTag");
const nextBtn   = document.getElementById("nextBtn");
const revealBtn = document.getElementById("revealBtn");
const loadBtn   = document.getElementById("loadBtn");
const resetBtn  = document.getElementById("resetBtn");

function render(){
  const item = ITEMS[idx];
  promptEl.textContent = (item.type==="identify-verb" ? "Which word is the verb?\n" :
                           item.type==="identify-subject" ? "Which word is the subject?\n" :
                           "Does the subject and the verb agree in number?\n") + "\nSentence: " + item.sentence;

  choicesEl.innerHTML = "";
  item.choices.forEach((choice, i)=>{
    const li = document.createElement("li");
    const btn = document.createElement("button");
    btn.textContent = (i+1)+". "+choice;
    btn.addEventListener("click", ()=>grade(i));
    li.appendChild(btn);
    choicesEl.appendChild(li);
  });
  modeTag.textContent = "mode: " + item.type;
  counterTag.textContent = (idx+1) + "/" + ITEMS.length;
  statusEl.textContent = "";
  explainEl.innerHTML = "";
}

function grade(selectionIndex){
  const item = ITEMS[idx];
  const correct = selectionIndex === item.answerIndex;
  statusEl.innerHTML = correct ? "Correct." : "Incorrect.";
  statusEl.className = correct ? "status good" : "status bad";

  // Annotate choices
  [...choicesEl.querySelectorAll("button")].forEach((b, i)=>{
    if(i === item.answerIndex) b.classList.add("good");
    if(i === selectionIndex && i !== item.answerIndex) b.classList.add("bad");
    b.disabled = true;
  });

  explainEl.innerHTML = `
    <div><strong>Why:</strong> ${item.explanation}</div>
    <div class="muted" style="margin-top:6px"><strong>Sources:</strong> ${ (item.sources||[]).map(k=>PUBLIC_DOMAIN_SOURCES[k]||k).join(" · ") }</div>
  `;
}

function reveal(){
  grade(ITEMS[idx].answerIndex);
}
function next(){
  idx = (idx+1) % ITEMS.length;
  render();
}
revealBtn.addEventListener("click", reveal);
nextBtn.addEventListener("click", next);

/* Loading custom JSON */
loadBtn.addEventListener("click", ()=>{
  const raw = document.getElementById("jsonInput").value.trim();
  if(!raw){ statusEl.textContent = "No JSON provided."; statusEl.className="status bad"; return; }
  try{
    const data = JSON.parse(raw);
    if(!Array.isArray(data) || data.length===0) throw new Error("Expected a non-empty array.");
    ITEMS = data;
    idx = 0; render();
    statusEl.textContent = "Loaded custom JSON set.";
    statusEl.className = "status good";
  }catch(err){
    statusEl.textContent = "JSON error: " + err.message;
    statusEl.className = "status bad";
  }
});

/* Reset to demo set */
resetBtn.addEventListener("click", ()=>{
  ITEMS = JSON.parse(JSON.stringify(defaultDemo));
  idx = 0; render();
  statusEl.textContent = "Restored demo set.";
  statusEl.className = "status good";
});

/* Keep an immutable copy for reset */
const defaultDemo = JSON.parse(JSON.stringify(ITEMS));

/* Keyboard shortcuts: 1–9 answer, N next, R reveal */
window.addEventListener("keydown", (e)=>{
  const k = e.key.toLowerCase();
  if(k === "n"){ next(); return; }
  if(k === "r"){ reveal(); return; }
  const digit = parseInt(k,10);
  if(!Number.isNaN(digit)){
    const i = digit - 1;
    const btns = choicesEl.querySelectorAll("button");
    if(i>=0 && i<btns.length && !btns[i].disabled) btns[i].click();
  }
});

/* Initial render */
render();
</script>
</body>
</html>
